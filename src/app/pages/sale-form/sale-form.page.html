
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>Registrar Venta</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content>
    <form [formGroup]="form" (ngSubmit)="save()" class="ion-padding">
      <ion-list>
        <ion-item>
          <ion-label position="stacked">Fecha</ion-label>
          <ion-input type="date" formControlName="date"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Cliente</ion-label>
          <ion-input formControlName="customer" placeholder="Nombre del cliente"></ion-input>
        </ion-item>
      </ion-list>

      <div class="ion-padding-top">
        <h2>Ítems</h2>
        <ion-list>
          <ng-container *ngFor="let g of items.controls; let i = index; trackBy: trackByIndex">
            <ion-item>
              <ion-label position="stacked">Producto</ion-label>
              <ion-select interface="popover" [formControl]="$any(g.get('productId'))" (ionChange)="onProductChange(i)">
                <ion-select-option *ngFor="let p of products()" [value]="p.id">{{ p.name }} ({{ p.price | currency:'ARS':'symbol-narrow' }})</ion-select-option>
              </ion-select>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">Cantidad</ion-label>
              <ion-input type="number" [formControl]="$any(g.get('quantity'))" (ionInput)="recalc(i)"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">Precio Unitario</ion-label>
              <ion-input type="number" [formControl]="$any(g.get('unitPrice'))" (ionInput)="recalc(i)"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label>Subtotal:  </ion-label>
              <ion-input [value]="g.get('subtotal')?.value" readonly></ion-input>
            </ion-item>
            <div class="ion-padding-bottom">
              <ion-button color="danger" fill="clear" (click)="removeItem(i)" (keydown.enter)="removeItem(i)" (keydown.space)="removeItem(i)"><ion-icon name="remove-circle"></ion-icon> Quitar</ion-button>
            </div>
          </ng-container>
        </ion-list>
        <ion-button (click)="addItem()" (keydown.enter)="addItem()" (keydown.space)="addItem()"><ion-icon name="add-circle"></ion-icon> Agregar ítem</ion-button>
      </div>

      <!-- TODO Agregar Total -->
      <div class="ion-padding-top">
        <h2>Total: {{ total() | currency:'ARS':'symbol-narrow' }}</h2>
      </div>

      <div class="ion-padding">
        <ion-button type="submit" [disabled]="form.invalid || items.length===0" expand="block">Guardar Venta</ion-button>
        <ion-button fill="clear" color="medium" expand="block" (click)="cancel()" (keydown.enter)="cancel()" (keydown.space)="cancel()">Cancelar</ion-button>
      </div>
    </form>
  </ion-content>
